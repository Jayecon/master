강원_211_DT_211002_D004_20260215054246.csv
강원_211-DT_211002_D005_20260215054314.csv
경기_210_DT_21002D002_20260215054050.csv
경기_210_DT_21002D003_20260215054125.csv
경남_217_DT_217003N_D002_20260215055312.csv
경남_217_DT_217003N_D003_20260215055332.csv
경북_216_DT_21603_D001003_20260215055214.csv
경북_종사자규모별_사업체수_및_종사자수_20260215055156.csv
광주_산업별_구별_사업체수_및_종사자수_20260215053423.cSv
광주_종사자규모별_사업체수_및_종사자수_20260215053330.csv
대구_203_DT_D50002_20260214182212.csv
대구_종사자규모별_사업체수_및_종사자수_20260214182155.cSv
대전_산업별_사업체수_및_종사자수_20260215053623.csv
대전_종사자규모별_사업체수_및_종사자수_20260215053541.csv
부산_산업별_구·군별_사업체수_및_종사자수_20260214182024.cSv
부산_산업별_구·군별_사업체수_및_종사자수_20260214182054.cSv
부산_종사자_규모별_사업체수_및_종사자수_20260214181920.csv
서울_사업체현황_산업대분류별_동별_20260215055918.csv
서울_사업체현황_종사자규모별_동별_20260215055736.csv
세종_208_DT_20802N_03720260215053931.csv
세종_종사규모별_사업체수_및_종사자수_20260215053907.csv
울산_산업별_사업체수_및_종사자수_20260215053804.cSv
울산_종사자규모별_사업체수_및_종사자수_20260215053721.csv
인천_산업별_사업체수_및_종사자수_20260214182402.csv
인천_종사자_규모별_사업체수_및_종사자수_20260214182327.csv
전남_215_DT_215N_D05_20260215055034.csv
전남E_215_DT_215N_D10_20260215055055.csv
전북_214_DT_21402_D004_20260215054946.csv
전북_종사자규모별_사업체수_및_종사자수_20260215054927.csv
제주_산업별_사업체수_및_종사자수_20260215055501.csv
제주_종사자규모별_사업체수_및_종사자수_20260215055429.csv
충남_213_DT_21303_D000006_20260215054747.csv
중남_종사자규모별_사업체수_및_종사자수_20260215054727.csv
충북_산업별_사업체수_및_종사자수_20260215054534.cSv
충북_종사자_규모별_사업체수_및_종사자수_20260215054452.csv

*******************************************************
* 0. 기본 설정
*******************************************************
global	path ~/dropbox

cd "$path"

*******************************************************
* 1. 데이터 불러오기
*******************************************************
import delimited "강원_211_DT_211002_D004_20260215054246.csv", ///
    clear varnames(1) encoding()
	
*******************************************************
* 2. Id = 시군, time = 시점
*******************************************************
rename 시군 id
rename 시점 time

*******************************************************
* 3. time 숫자만 추출
*******************************************************
capture confirm string variable time
if _rc == 0 {
    gen time_num = real(regexs(0)) if regexm(time, "[0-9]+")
    drop time    
	rename time_num time
}

*******************************************************
* 4. 종사자규모별 → numeric category + value label
*******************************************************
* 문자열일 경우 encode (자동으로 value label 생성)
capture confirm string variable 종사자규모별
if _rc == 0 {
    encode 종사자규모별, gen(size_cat)
    drop 종사자규모별
    rename size_cat size_cat
}

* 이미 numeric인 경우 value label이 없으면 새로 생성
capture confirm numeric variable size_cat
if _rc != 0 {
    capture confirm numeric variable 종사자규모별
    if _rc == 0 {
        rename 종사자규모별 size_cat
    }
}

* value label이 없는 경우 원래 문자열 기준으로 재생성
capture label list size_cat
if _rc != 0 {
    * 기존 문자열이 있었다고 가정한 재코딩 예시
    egen size_cat2 = group(size_cat), label
    drop size_cat
    rename size_cat2 size_cat
}

********************************************************
* 5. 사업체수, 종사자수 numeric 변환
*******************************************************
* 쉼표 제거 후 숫자화
foreach var in 사업체개 종사자명 {
    
    capture confirm string variable `var'
    if _rc == 0 {
        replace `var' = subinstr(`var', ",", "", .)
		replace `var' = subinstr(`var', "-", "", .)
		replace `var' = subinstr(`var', "x", "", .)
        destring `var', replace
    }
}

*******************************************************
* 6. 확인
*******************************************************
compress
describe
label list
tab size_cat

